<!DOCTYPE html>
<html lang="en" data-theme="night">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VishPro Agent</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-base-300 text-base-content">

  <!-- Header -->
  <header class="navbar bg-base-200 border-b border-base-content/10 px-4 min-h-14 gap-2">
    <div class="navbar-start gap-2">
      <img src="icon-128.png" alt="VishPro" class="w-8 h-8 rounded-lg shrink-0">
      <div class="min-w-0">
        <h1 id="headerTitle" class="text-sm font-semibold leading-tight truncate">VishPro</h1>
        <div class="flex items-center gap-2 text-xs opacity-50">
          <span class="status status-xs" id="statusDot"></span>
          <span id="statusText" class="truncate">Ready</span>
        </div>
      </div>
    </div>
    <div class="navbar-end gap-2">
      <button id="historyToggle" class="btn btn-ghost btn-sm btn-square" title="Data & History">
        <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
        </svg>
      </button>
      <button id="settingsToggle" class="btn btn-ghost btn-sm btn-square" title="Settings">
        <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Settings Panel -->
  <div class="hidden bg-base-200 border-b border-base-content/10" id="settingsPanel">
    <div class="p-3 h-[45vh] flex flex-col">
      <!-- Settings Tabs -->
      <div role="tablist" class="tabs tabs-boxed bg-base-300 settings-tabs shrink-0">
        <button role="tab" class="tab tab-active text-xs font-medium" data-settings-tab="models">
          <svg class="w-3.5 h-3.5 mr-1.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
          </svg>
          Models
        </button>
        <button role="tab" class="tab text-xs font-medium" data-settings-tab="ui">
          <svg class="w-3.5 h-3.5 mr-1.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/>
          </svg>
          Interface
        </button>
      </div>

      <!-- Models Tab Content -->
      <div id="settingsModelsTab" class="flex-1 overflow-y-auto mt-3">
        <label class="form-control w-full mb-3">
          <div class="label"><span class="label-text text-xs font-medium opacity-50">OpenRouter API Key</span></div>
          <label class="input input-bordered flex items-center gap-2">
            <input type="password" id="openrouterApiKey" class="grow" placeholder="sk-or-...">
            <span id="openrouterApiKeyStatus" class="text-sm"></span>
          </label>
        </label>
        <div class="text-xs opacity-50 mb-3">Get key from <a href="https://openrouter.ai/keys" target="_blank" class="link link-primary">openrouter.ai/keys</a></div>

        <div id="modelsBody" class="space-y-3">
          <div class="tier-section" data-tier="HIGH">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-error badge-sm">HIGH</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="HIGH" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListHigh"></ul>
          </div>
          <div class="tier-section" data-tier="MEDIUM">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-warning badge-sm">MEDIUM</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="MEDIUM" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListMedium"></ul>
          </div>
          <div class="tier-section" data-tier="LOW">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-success badge-sm">LOW</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="LOW" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListLow"></ul>
          </div>
        </div>
        <div class="flex justify-end pt-2 border-t border-base-content/10">
          <button class="btn btn-ghost btn-sm" id="resetModelsBtn">Reset to Defaults</button>
        </div>
      </div>

      <!-- UI Tab Content -->
      <div id="settingsUiTab" class="hidden flex-1 overflow-y-auto mt-3">
        <!-- Theme Selection -->
        <div class="card bg-base-300 p-3 mb-3">
          <div class="text-sm font-medium mb-3">Theme</div>
          <div id="themeSelector" class="grid grid-cols-4 gap-2">
            <button class="btn btn-ghost flex flex-col items-center gap-2 p-2 h-auto" data-theme="cupcake">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-200 to-pink-100 border-2 border-pink-300"></div>
              <span class="text-xs opacity-50">Cupcake</span>
            </button>
            <button class="btn btn-ghost flex flex-col items-center gap-2 p-2 h-auto" data-theme="retro">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-amber-200 to-orange-200 border-2 border-amber-400"></div>
              <span class="text-xs opacity-50">Retro</span>
            </button>
            <button class="btn btn-ghost flex flex-col items-center gap-2 p-2 h-auto" data-theme="sunset">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-rose-500 border-2 border-orange-500"></div>
              <span class="text-xs opacity-50">Sunset</span>
            </button>
            <button class="btn btn-ghost flex flex-col items-center gap-2 p-2 h-auto" data-theme="night">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-slate-700 to-slate-900 border-2 border-indigo-500"></div>
              <span class="text-xs opacity-50">Night</span>
            </button>
          </div>
        </div>

        <!-- Zoom Controls -->
        <div class="card bg-base-300 p-3">
          <div class="flex items-center justify-between mb-3">
            <div class="text-sm font-medium">Zoom</div>
            <div class="flex items-center gap-2">
              <button id="zoomOut" class="btn btn-ghost btn-sm btn-square" title="Zoom out">−</button>
              <span id="zoomLevel" class="badge badge-ghost text-sm font-mono min-w-14">100%</span>
              <button id="zoomIn" class="btn btn-ghost btn-sm btn-square" title="Zoom in">+</button>
            </div>
          </div>
          <input type="range" id="zoomSlider" min="75" max="150" value="100" step="5" class="range range-xs range-primary w-full">
          <div class="flex justify-between text-xs opacity-50 mt-1">
            <span>75%</span>
            <span>150%</span>
          </div>
        </div>

        <div class="flex justify-end pt-3">
          <button class="btn btn-ghost btn-sm" id="resetUiBtn">Reset to Defaults</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Extraction Panel -->
  <div class="hidden bg-base-200 border-b border-base-content/10" id="extractionPanel">
    <div class="p-3 h-[40vh] flex flex-col">
      <div role="tablist" class="tabs tabs-boxed bg-base-300 mb-2 shrink-0">
        <button role="tab" class="tab tab-active text-xs" data-tab="current">Current</button>
        <button role="tab" class="tab text-xs" data-tab="history">History</button>
        <button role="tab" class="tab text-xs" data-tab="actions">Actions</button>
        <button role="tab" class="tab text-xs" data-tab="stats">Stats</button>
      </div>

      <div id="currentTabContent" class="flex-1 flex flex-col overflow-hidden">
        <button id="extractButton" class="btn btn-primary btn-sm w-full mb-2 gap-2 shrink-0">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Extract
        </button>
        <div id="currentTabExtractionContent" class="flex-1 overflow-y-auto"></div>
      </div>
      <div id="historyTabContent" class="hidden flex-1 overflow-y-auto"></div>
      <div id="actionsTabContent" class="hidden flex-1 overflow-y-auto"></div>
      <div id="statsTabContent" class="hidden flex-1 overflow-y-auto">
        <div class="model-stats-container space-y-3" id="modelStatsContainer">
          <div class="stats-empty text-center py-8 opacity-50">
            <svg class="w-10 h-10 mx-auto mb-2 opacity-30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/>
            </svg>
            <p class="text-xs">No model stats yet</p>
            <p class="text-xs opacity-50 mt-1">Stats appear after models are used</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="flex-1 overflow-y-auto p-3 space-y-3" id="chatContainer">
    <div class="empty-state flex-1 flex flex-col items-center justify-center text-center py-8 opacity-50">
      <svg class="w-12 h-12 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
      <p class="text-sm">Ready to help.<br>Ask me to interact with this page.</p>
    </div>
  </div>

  <!-- Input Area -->
  <div class="bg-base-200 border-t border-base-content/10 p-3">
    <div class="flex gap-2 items-end">
      <textarea id="messageInput" class="textarea textarea-bordered flex-1 min-h-10 max-h-32 text-sm resize-none leading-relaxed" placeholder="Read the page, click a button, fill a form..." rows="1"></textarea>
      <button id="sendButton" class="btn btn-primary btn-square" title="Send">
        <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
        </svg>
      </button>
    </div>
    <p class="text-xs opacity-50 text-center mt-2"><kbd class="kbd kbd-xs">Enter</kbd> to send · <kbd class="kbd kbd-xs">Shift+Enter</kbd> for new line</p>
  </div>

  <!-- Templates -->
  <template id="tpl-model-item">
    <li class="list-row items-center">
      <div class="drag-handle cursor-grab opacity-50 hover:opacity-100 transition-opacity"><svg width="10" height="14" viewBox="0 0 10 14" fill="currentColor"><circle cx="2" cy="2" r="1.5"/><circle cx="8" cy="2" r="1.5"/><circle cx="2" cy="7" r="1.5"/><circle cx="8" cy="7" r="1.5"/><circle cx="2" cy="12" r="1.5"/><circle cx="8" cy="12" r="1.5"/></svg></div>
      <div class="status-indicator flex items-center gap-2"></div>
      <div class="list-col-grow min-w-0">
        <div class="flex items-center gap-2">
          <span class="model-name text-xs font-mono truncate"></span>
          <span class="warning-indicator hidden"></span>
        </div>
        <div class="flex items-center gap-2 mt-0.5">
          <div class="provider-badges flex gap-2"></div>
          <div class="model-stats flex items-center gap-2 text-xs opacity-50"></div>
        </div>
      </div>
      <button class="btn btn-ghost btn-xs btn-square edit" title="Edit"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
      <button class="btn btn-ghost btn-xs btn-square delete hover:btn-error" title="Remove"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </li>
  </template>
  <template id="tpl-model-editing">
    <li class="list-row items-center bg-base-200">
      <div class="size-2.5"></div>
      <div class="list-col-grow min-w-0 space-y-1">
        <div class="dropdown dropdown-bottom dropdown-open w-full"><input type="text" class="model-name-input input input-xs input-bordered w-full font-mono" placeholder="model/name" autocomplete="off"><ul class="model-autocomplete dropdown-content flex flex-col bg-base-200 rounded-lg z-50 w-full max-h-48 overflow-y-auto shadow-lg border border-base-content/10 p-1 hidden"></ul></div>
        <div class="flex items-center gap-2"><span class="text-xs opacity-50">via</span><div class="dropdown dropdown-bottom dropdown-end dropdown-open flex-1"><input type="text" class="model-provider-input input input-xs input-bordered w-full" placeholder="provider (optional)" autocomplete="off"><ul class="provider-autocomplete dropdown-content flex flex-col bg-base-200 rounded-lg z-50 w-full max-h-48 overflow-y-auto shadow-lg border border-base-content/10 p-1 hidden"></ul></div></div>
      </div>
      <button class="btn btn-ghost btn-xs btn-square save hover:btn-success" title="Save"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg></button>
      <button class="btn btn-ghost btn-xs btn-square cancel" title="Cancel"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </li>
  </template>
  <template id="tpl-stats-card">
    <div class="model-stat-card bg-base-300 rounded-lg p-3 border border-base-content/10">
      <div class="flex items-center gap-2">
        <div class="radial-progress text-xs font-mono shrink-0" style="--size:3rem; --thickness:3px;" role="progressbar"><span class="stat-rate text-xs font-semibold"></span></div>
        <div class="flex-1 min-w-0"><div class="stat-model font-mono text-xs truncate"></div><div class="stat-provider text-xs opacity-50"></div>
          <div class="flex gap-2 mt-1"><span class="text-xs text-success flex items-center gap-2"><span class="inline-block w-1.5 h-1.5 rounded-full bg-current opacity-50"></span><span class="stat-success"></span></span><span class="text-xs text-error flex items-center gap-2"><span class="inline-block w-1.5 h-1.5 rounded-full bg-current opacity-50"></span><span class="stat-error"></span></span><span class="stat-total text-xs opacity-50"></span></div>
        </div>
      </div>
    </div>
  </template>
  <template id="tpl-stats-summary">
    <div class="stats-summary bg-base-300/50 rounded-lg p-3 mb-3 border border-base-content/5">
      <div class="flex items-center justify-between"><div class="text-xs font-medium opacity-50">Overall Performance</div>
        <div class="flex items-center gap-3"><div class="text-right"><div class="summary-rate text-lg font-mono font-semibold"></div><div class="summary-calls text-xs opacity-50"></div></div><div class="flex flex-col gap-0.5 text-xs"><span class="summary-ok text-success"></span><span class="summary-err text-error"></span></div></div>
      </div>
    </div>
  </template>
  <template id="tpl-extraction-item">
    <div class="card bg-base-300 border border-base-content/10 cursor-pointer mb-2">
      <div class="card-body p-3 gap-2"><div class="flex justify-between items-start"><h3 class="ext-title card-title text-sm truncate flex-1"></h3><span class="ext-time text-xs opacity-50 ml-2 shrink-0"></span></div>
        <p class="ext-url text-xs opacity-50 truncate"></p>
        <div class="flex gap-2 text-xs opacity-50 mt-1"><span><span class="ext-chars text-primary font-medium"></span> chars</span><span><span class="ext-links text-primary font-medium"></span> links</span><span><span class="ext-buttons text-primary font-medium"></span> buttons</span></div>
      </div>
    </div>
  </template>
  <template id="tpl-extraction-detail">
    <div class="card bg-base-300 border border-base-content/10 h-full overflow-y-auto">
      <div class="card-body p-3"><div class="border-b border-base-content/10 pb-2.5 mb-1 shrink-0"><h3 class="detail-title font-medium text-sm"></h3><p class="detail-url text-xs opacity-50 break-all mt-1"></p><p class="detail-time text-xs opacity-50 mt-1.5"></p></div><div class="detail-sections"></div></div>
    </div>
  </template>
  <template id="tpl-extraction-section"><div class="mt-3"><div class="section-label text-xs font-semibold uppercase tracking-wide opacity-50 mb-1.5"></div><div class="section-content text-xs leading-relaxed opacity-50 whitespace-pre-wrap break-words bg-base-300 p-3 rounded max-h-[15vh] overflow-y-auto"></div></div></template>
  <template id="tpl-action-item"><div class="bg-base-300 border border-base-content/10 rounded-lg p-3 mb-1.5"><div class="action-time text-xs opacity-50"></div><div class="action-desc text-xs opacity-50 leading-relaxed mt-0.5"></div></div></template>

  <script src="sidepanel.js" type="module"></script>
</body>
</html>
